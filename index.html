import React, { useState, useEffect } from 'react';
import { CheckCircle2, Circle, TrendingUp, Calendar, Target, DollarSign, Zap, BookOpen, Bot, Award } from 'lucide-react';

const ProjectDashboard = () => {
  const [currentTime, setCurrentTime] = useState(new Date());
  const [projects, setProjects] = useState({
    agentLinkedIn: { completed: 0, total: 30, revenue: 0 },
    ebooks: { completed: 0, total: 3, revenue: 0 },
    agentCRD: { completed: 0, total: 15, revenue: 0 },
    agentProspecteur: { completed: 0, total: 10, revenue: 0 }
  });
  const [dailyTasks, setDailyTasks] = useState({});
  const [totalRevenue, setTotalRevenue] = useState(0);

  useEffect(() => {
    const timer = setInterval(() => setCurrentTime(new Date()), 60000);
    loadData();
    return () => clearInterval(timer);
  }, []);

  const loadData = () => {
    const saved = localStorage.getItem('projectData');
    if (saved) {
      const data = JSON.parse(saved);
      setProjects(data.projects || projects);
      setDailyTasks(data.dailyTasks || {});
      setTotalRevenue(data.totalRevenue || 0);
    }
  };

  const saveData = () => {
    localStorage.setItem('projectData', JSON.stringify({
      projects,
      dailyTasks,
      totalRevenue
    }));
  };

  useEffect(() => {
    saveData();
  }, [projects, dailyTasks, totalRevenue]);

  const getCurrentDay = () => {
    const days = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
    return days[currentTime.getDay()];
  };

  const getDayNumber = () => {
    const start = new Date('2025-01-23');
    const diff = Math.floor((currentTime - start) / (1000 * 60 * 60 * 24));
    return Math.max(0, Math.min(30, diff + 1));
  };

  const getTodaysTasks = () => {
    const day = currentTime.getDay();
    const dayNum = getDayNumber();
    
    let tasks = [
      { id: 'doc', icon: 'ðŸ“¸', text: 'Documentation LinkedIn (post + story)', project: 'agentLinkedIn', priority: 'urgent' }
    ];

    // Semaine 1 (jours 1-7)
    if (dayNum <= 7) {
      if (dayNum === 1) {
        tasks.push(
          { id: 'agent1', icon: 'ðŸ¤–', text: 'FINIR Agent LinkedIn - DÃ©bloquer paramÃ¨tres', project: 'agentLinkedIn', priority: 'urgent' },
          { id: 'plan', icon: 'ðŸ“‹', text: 'Structurer les 2-3 e-books existants', project: 'ebooks', priority: 'important' }
        );
      } else {
        if (day === 1 || day === 3) {
          tasks.push({ id: 'ebook', icon: 'ðŸ“š', text: 'Travail e-books (2h)', project: 'ebooks', priority: 'important' });
        } else if (day === 2 || day === 4) {
          tasks.push({ id: 'research', icon: 'ðŸ”', text: 'Recherche template CRD pro', project: 'agentCRD', priority: 'important' });
        }
      }
    }
    
    // Semaine 2 (jours 8-14)
    else if (dayNum <= 14) {
      if (day === 1 || day === 3) {
        tasks.push(
          { id: 'ebook', icon: 'ðŸ“š', text: 'RÃ©daction e-books (3h)', project: 'ebooks', priority: 'urgent' },
          { id: 'crd1', icon: 'ðŸ¤–', text: 'DÃ©veloppement Agent CRD v1', project: 'agentCRD', priority: 'important' }
        );
      } else if (day === 2 || day === 4) {
        tasks.push({ id: 'crd2', icon: 'âš™ï¸', text: 'AmÃ©lioration Agent CRD', project: 'agentCRD', priority: 'urgent' });
      }
    }
    
    // Semaine 3 (jours 15-21)
    else if (dayNum <= 21) {
      tasks.push(
        { id: 'gumroad', icon: 'ðŸ’°', text: 'Setup Gumroad + pages de vente', project: 'ebooks', priority: 'urgent' },
        { id: 'prosp', icon: 'ðŸŽ¯', text: 'DÃ©veloppement Agent Prospecteur', project: 'agentProspecteur', priority: 'important' }
      );
    }
    
    // Semaine 4 (jours 22-30)
    else {
      tasks.push(
        { id: 'package', icon: 'ðŸ“¦', text: 'Packaging Combo Agent LinkedIn', project: 'agentLinkedIn', priority: 'urgent' },
        { id: 'sales', icon: 'ðŸš€', text: 'Marketing & Ventes actives', project: 'ebooks', priority: 'urgent' }
      );
    }

    // TÃ¢ches quotidiennes fixes
    tasks.push(
      { id: 'linkedin', icon: 'ðŸ’¼', text: 'RÃ©pondre messages LinkedIn/rÃ©seaux', project: 'general', priority: 'normal' },
      { id: 'revenue', icon: 'ðŸ’µ', text: 'Mettre Ã  jour revenus du jour', project: 'general', priority: 'normal' }
    );

    return tasks;
  };

  const toggleTask = (taskId) => {
    setDailyTasks(prev => ({
      ...prev,
      [taskId]: !prev[taskId]
    }));
  };

  const updateProgress = (projectKey, field, value) => {
    setProjects(prev => ({
      ...prev,
      [projectKey]: {
        ...prev[projectKey],
        [field]: parseInt(value) || 0
      }
    }));
  };

  const getPriorityColor = (priority) => {
    switch(priority) {
      case 'urgent': return 'bg-red-100 border-red-500 text-red-800';
      case 'important': return 'bg-orange-100 border-orange-500 text-orange-800';
      default: return 'bg-blue-100 border-blue-500 text-blue-800';
    }
  };

  const calculateTotalRevenue = () => {
    return Object.values(projects).reduce((sum, p) => sum + (p.revenue || 0), 0);
  };

  const tasks = getTodaysTasks();
  const completedTasks = Object.values(dailyTasks).filter(Boolean).length;
  const dayNum = getDayNumber();

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 p-4">
      <div className="max-w-6xl mx-auto">
        {/* Header */}
        <div className="bg-white rounded-3xl shadow-xl p-6 mb-6">
          <div className="text-center mb-4">
            <div className="text-5xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2">
              JOUR {dayNum}/30
            </div>
            <div className="text-xl text-gray-600">{getCurrentDay()} - {currentTime.toLocaleDateString('fr-FR')}</div>
            <div className="text-lg text-gray-500 mt-2">
              {currentTime.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}
            </div>
          </div>

          <div className="bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-2xl p-6 mt-4">
            <div className="flex items-center justify-between mb-3">
              <div className="flex items-center gap-2">
                <DollarSign size={28} />
                <span className="text-2xl font-bold">Revenus Total</span>
              </div>
              <div className="text-4xl font-bold">{calculateTotalRevenue()}â‚¬</div>
            </div>
            <div className="text-sm opacity-90">Objectif Mars : 1750â‚¬ minimum</div>
          </div>
        </div>

        {/* TÃ¢ches du jour */}
        <div className="bg-white rounded-3xl shadow-xl p-6 mb-6">
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-2xl font-bold flex items-center gap-2">
              <Zap className="text-yellow-500" />
              TÃ¢ches du Jour
            </h2>
            <div className="bg-purple-100 px-4 py-2 rounded-full">
              <span className="font-semibold text-purple-700">{completedTasks}/{tasks.length} faites</span>
            </div>
          </div>

          <div className="space-y-3">
            {tasks.map(task => (
              <div
                key={task.id}
                onClick={() => toggleTask(task.id)}
                className={`${getPriorityColor(task.priority)} border-2 rounded-2xl p-4 cursor-pointer transition-all hover:scale-102 ${
                  dailyTasks[task.id] ? 'opacity-50 line-through' : ''
                }`}
              >
                <div className="flex items-center gap-3">
                  {dailyTasks[task.id] ? (
                    <CheckCircle2 className="text-green-600 flex-shrink-0" size={24} />
                  ) : (
                    <Circle className="flex-shrink-0" size={24} />
                  )}
                  <span className="text-3xl">{task.icon}</span>
                  <div className="flex-grow">
                    <div className="font-semibold text-lg">{task.text}</div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>

        {/* Projets */}
        <div className="grid md:grid-cols-2 gap-6 mb-6">
          {/* Agent LinkedIn */}
          <div className="bg-white rounded-3xl shadow-xl p-6">
            <div className="flex items-center gap-3 mb-4">
              <Bot className="text-blue-600" size={32} />
              <h3 className="text-xl font-bold">Agent LinkedIn Content</h3>
            </div>
            <div className="mb-4">
              <div className="flex justify-between text-sm mb-2">
                <span>Documentation</span>
                <span className="font-bold">{projects.agentLinkedIn.completed}/30 jours</span>
              </div>
              <div className="w-full bg-blue-200 rounded-full h-3">
                <div 
                  className="bg-blue-600 h-3 rounded-full transition-all"
                  style={{ width: `${(projects.agentLinkedIn.completed / 30) * 100}%` }}
                />
              </div>
            </div>
            <input
              type="number"
              value={projects.agentLinkedIn.completed}
              onChange={(e) => updateProgress('agentLinkedIn', 'completed', e.target.value)}
              className="w-full p-3 border-2 border-blue-300 rounded-lg mb-3"
              placeholder="Jours documentÃ©s"
              max="30"
            />
            <input
              type="number"
              value={projects.agentLinkedIn.revenue}
              onChange={(e) => updateProgress('agentLinkedIn', 'revenue', e.target.value)}
              className="w-full p-3 border-2 border-green-300 rounded-lg"
              placeholder="Revenus gÃ©nÃ©rÃ©s (â‚¬)"
            />
          </div>

          {/* E-books */}
          <div className="bg-white rounded-3xl shadow-xl p-6">
            <div className="flex items-center gap-3 mb-4">
              <BookOpen className="text-purple-600" size={32} />
              <h3 className="text-xl font-bold">E-books</h3>
            </div>
            <div className="mb-4">
              <div className="flex justify-between text-sm mb-2">
                <span>Progression</span>
                <span className="font-bold">{projects.ebooks.completed}/3 e-books</span>
              </div>
              <div className="w-full bg-purple-200 rounded-full h-3">
                <div 
                  className="bg-purple-600 h-3 rounded-full transition-all"
                  style={{ width: `${(projects.ebooks.completed / 3) * 100}%` }}
                />
              </div>
            </div>
            <input
              type="number"
              value={projects.ebooks.completed}
              onChange={(e) => updateProgress('ebooks', 'completed', e.target.value)}
              className="w-full p-3 border-2 border-purple-300 rounded-lg mb-3"
              placeholder="E-books terminÃ©s"
              max="3"
            />
            <input
              type="number"
              value={projects.ebooks.revenue}
              onChange={(e) => updateProgress('ebooks', 'revenue', e.target.value)}
              className="w-full p-3 border-2 border-green-300 rounded-lg"
              placeholder="Ventes e-books (â‚¬)"
            />
          </div>

          {/* Agent CRD */}
          <div className="bg-white rounded-3xl shadow-xl p-6">
            <div className="flex items-center gap-3 mb-4">
              <Target className="text-orange-600" size={32} />
              <h3 className="text-xl font-bold">Agent CRD</h3>
            </div>
            <div className="mb-4">
              <div className="flex justify-between text-sm mb-2">
                <span>DÃ©veloppement</span>
                <span className="font-bold">{projects.agentCRD.completed}/15 jours</span>
              </div>
              <div className="w-full bg-orange-200 rounded-full h-3">
                <div 
                  className="bg-orange-600 h-3 rounded-full transition-all"
                  style={{ width: `${(projects.agentCRD.completed / 15) * 100}%` }}
                />
              </div>
            </div>
            <input
              type="number"
              value={projects.agentCRD.completed}
              onChange={(e) => updateProgress('agentCRD', 'completed', e.target.value)}
              className="w-full p-3 border-2 border-orange-300 rounded-lg mb-3"
              placeholder="Jours de dev"
              max="15"
            />
            <input
              type="number"
              value={projects.agentCRD.revenue}
              onChange={(e) => updateProgress('agentCRD', 'revenue', e.target.value)}
              className="w-full p-3 border-2 border-green-300 rounded-lg"
              placeholder="Revenus CRD (â‚¬)"
            />
          </div>

          {/* Agent Prospecteur */}
          <div className="bg-white rounded-3xl shadow-xl p-6">
            <div className="flex items-center gap-3 mb-4">
              <Award className="text-pink-600" size={32} />
              <h3 className="text-xl font-bold">Agent Prospecteur</h3>
            </div>
            <div className="mb-4">
              <div className="flex justify-between text-sm mb-2">
                <span>DÃ©veloppement</span>
                <span className="font-bold">{projects.agentProspecteur.completed}/10 jours</span>
              </div>
              <div className="w-full bg-pink-200 rounded-full h-3">
                <div 
                  className="bg-pink-600 h-3 rounded-full transition-all"
                  style={{ width: `${(projects.agentProspecteur.completed / 10) * 100}%` }}
                />
              </div>
            </div>
            <input
              type="number"
              value={projects.agentProspecteur.completed}
              onChange={(e) => updateProgress('agentProspecteur', 'completed', e.target.value)}
              className="w-full p-3 border-2 border-pink-300 rounded-lg mb-3"
              placeholder="Jours de dev"
              max="10"
            />
            <input
              type="number"
              value={projects.agentProspecteur.revenue}
              onChange={(e) => updateProgress('agentProspecteur', 'revenue', e.target.value)}
              className="w-full p-3 border-2 border-green-300 rounded-lg"
              placeholder="Ventes agent (â‚¬)"
            />
          </div>
        </div>

        {/* Timeline 30 jours */}
        <div className="bg-white rounded-3xl shadow-xl p-6">
          <h2 className="text-2xl font-bold mb-6 flex items-center gap-2">
            <Calendar className="text-purple-600" />
            Timeline 30 Jours
          </h2>
          <div className="space-y-4">
            <div className={`p-4 rounded-xl ${dayNum <= 7 ? 'bg-purple-100 border-2 border-purple-500' : 'bg-gray-100'}`}>
              <div className="font-bold text-lg mb-2">ðŸš€ Semaine 1 (Jours 1-7) : BASES</div>
              <div className="text-sm">âœ… Finir Agent LinkedIn â€¢ Documentation quotidienne â€¢ Structure e-books</div>
            </div>
            <div className={`p-4 rounded-xl ${dayNum > 7 && dayNum <= 14 ? 'bg-purple-100 border-2 border-purple-500' : 'bg-gray-100'}`}>
              <div className="font-bold text-lg mb-2">ðŸ“š Semaine 2 (Jours 8-14) : CRÃ‰ATION</div>
              <div className="text-sm">âœ… RÃ©daction e-books â€¢ DÃ©veloppement Agent CRD v1</div>
            </div>
            <div className={`p-4 rounded-xl ${dayNum > 14 && dayNum <= 21 ? 'bg-purple-100 border-2 border-purple-500' : 'bg-gray-100'}`}>
              <div className="font-bold text-lg mb-2">ðŸ’° Semaine 3 (Jours 15-21) : LANCEMENT</div>
              <div className="text-sm">âœ… Setup Gumroad â€¢ Lancement e-books â€¢ Agent Prospecteur</div>
            </div>
            <div className={`p-4 rounded-xl ${dayNum > 21 ? 'bg-purple-100 border-2 border-purple-500' : 'bg-gray-100'}`}>
              <div className="font-bold text-lg mb-2">ðŸ”¥ Semaine 4 (Jours 22-30) : VENTES</div>
              <div className="text-sm">âœ… Packaging combo â€¢ Marketing actif â€¢ Premiers revenus !</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default ProjectDashboard;
